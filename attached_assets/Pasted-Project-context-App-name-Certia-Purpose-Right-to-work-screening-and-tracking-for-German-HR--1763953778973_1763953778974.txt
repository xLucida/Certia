Project context:
- App name: Certia.
- Purpose: Right-to-work screening and tracking for German HR.
- Current key features:
  - Employees and right-to-work checks with AI + rules-based decisions.
  - Upload-first OCR flow (German residence permits).
  - Renewals tracking:
    - Dashboard “Expiring Documents” card (Overdue / Expiring soon / Upcoming).
    - Employee detail “Right-to-Work Status” card with next expiry + countdown.
  - Per-check “Case file notes” on the check detail page (internal notes, print-hidden).
  - Check decision UI with:
    - Status badge
    - Decision summary
    - Decision details
    - “Missing information” section
    - Legal disclaimer
  - A simple “Print summary” action on check detail (window.print + basic print styles).

Goal for this phase:
Add **audit-friendly exports** so HR can easily present evidence for right-to-work checks:

1) Upgrade the **per-check print view** into a clean, audit-ready “Check Audit Report”.
2) Add an **employee-level audit report** that prints all checks for that employee in one go.
3) Add a **simple CSV export** of checks for the current account from the dashboard.

Overall constraints:
- Do NOT change the database schema.
- Do NOT change any existing workStatus or AI/rules logic.
- Keep all new features additive and minimal; no refactors of unrelated code.
- Use browser printing (`window.print()`) and CSV download only; do NOT generate server-side PDFs.

==================================================
TASK 1 — Upgrade the per-check “Print summary” into an audit-ready report
==================================================

Goal:
When HR clicks “Print summary” on a check detail page, the printed page should look like a proper **Audit Report** for that single check.

1) Locate the standalone check detail page:
   - Likely `client/src/pages/check-detail.tsx`.
   - It already shows:
     - Employee / check header
     - Decision status + summary + details + missing info
     - Case file notes section (currently print:hidden)
     - A “Print summary” button that calls `window.print()`.

2) Enhance the print layout using `@media print` styles and structural tweaks:

- In the JSX for the check detail page, wrap the core content in a container that:
  - Is fully visible in print
  - Hides navigation/sidebar/buttons when printing

- In the main stylesheet or appropriate CSS/Tailwind area (where you already define print styles, e.g. layout shell), ensure:

  - During print:
    - Hide:
      - App navigation/top bar/side bar
      - Action buttons (e.g. Print, Delete, Add Note)
    - Show:
      - App logo / name “Certia”
      - A clear title: “Right-to-Work Check Audit Report”

3) Add structured audit information to the printed view:

Within the printable portion of the check detail, ensure the following sections appear clearly, in this order:

- Header:
  - Certia logo/name
  - Title: “Right-to-Work Check Audit Report”
  - Date of report (print time, e.g. using `new Date().toLocaleDateString()` rendered in normal view; it will print as-is).

- Section 1: Employee & Check Metadata
  - Employee name
  - Employee ID / reference (if available)
  - Check ID
  - Check creation date
  - Document type and document number (if stored)
  - Document expiry date

- Section 2: Decision Summary
  - Status badge text (ELIGIBLE / NOT_ELIGIBLE / NEEDS_REVIEW) rendered as normal text in print.
  - Decision summary paragraph.

- Section 3: Decision Details
  - Bullet list of decision details (existing `decisionDetails`), excluding any pure “Missing information” lines if you already handle those separately.

- Section 4: Missing Information
  - A bullet list of lines that start with:
    - "We could not determine from the information provided..."
  - If no missing information exists, show a simple line: “No missing information recorded.”

- Section 5: Case File Notes
  - For this audit mode, **include** case file notes in print:
    - Change the notes container so it is VISIBLE in print (remove `print:hidden` from the notes card, and instead hide only the “Add note” form in print).
    - Show:
      - “Case File Notes”
      - For each note (sorted newest first in the UI, but printing all):
        - Timestamp
        - Note content

- Section 6: Disclaimer
  - At the bottom, include the disclaimer already used in the decision panel, e.g.:

    > “This decision was generated by Certia AI using document scan data and internal rules. It is an internal screening tool and not legal advice. Always confirm right-to-work status using official documents and, where appropriate, legal counsel or the competent authorities.”

4) Ensure:
- On-screen layout remains as-is or minimally changed.
- The “Print summary” button still just calls `window.print()`.
- The printed page looks clean (no duplicate navigation, no input fields, no buttons, no unnecessary background colors).

==================================================
TASK 2 — Employee-level Audit Report (print all checks for one employee)
==================================================

Goal:
From an **employee detail** page, HR should be able to print a consolidated “Employee Audit Report” that includes all right-to-work checks for that employee.

2.1) Employee Audit Report view/controller

1) On the employee detail page (`client/src/pages/employee-detail.tsx`):

- Add a secondary button near the top (e.g., near the employee name or right-to-work status card):

  - Label: “Print employee audit report”
  - Variant: outline/secondary
  - On click: navigate to a dedicated route OR simply trigger a print-optimized view within the same page. Choose the approach that is simplest given the existing architecture, but prefer reusing the existing layout.

2) Add a printable section that includes:

- Basic employee info:
  - Employee name
  - Employee ID / reference
  - Any other basic attributes already available

- Summary:
  - Total number of checks
  - Count by status: ELIGIBLE / NOT_ELIGIBLE / NEEDS_REVIEW
  - Next expiry date and the “Expires in X days / Expired X days ago” line (reuse existing logic from the status card).

- List of checks:
  - For each check (sorted newest first):
    - Check ID
    - Creation date
    - Status
    - Document type/number (if available)
    - Expiry date
    - One-line summary (decisionSummary)
  - This can be a simple table.

3) Print behavior:

- Use `window.print()` when HR clicks “Print employee audit report”.
- Use `@media print` to:
  - Hide navigation, sidebars, and action buttons.
  - Show only the employee audit content.
- You can reuse the same print CSS techniques as in Task 1; just ensure both check-level and employee-level print views work without interfering with each other.

4) No new API endpoints are required if the employee detail page already has all check data for that employee. If it doesn’t:

- Reuse existing storage/endpoint patterns to fetch all checks for a given employee ID on the employee detail page.

==================================================
TASK 3 — CSV export of checks from the dashboard
==================================================

Goal:
Add a simple CSV export so HR can download a list of their right-to-work checks (for their tenant/account) directly from the dashboard.

3.1) Backend: CSV export endpoint

1) In `server/routes.ts` (or equivalent):

- Add an authenticated route:

  ```ts
  app.get("/api/audit/checks.csv", isAuthenticated, async (req: any, res) => {
    try {
      const userId = req.user.claims.sub;

      // Reuse or add a storage helper that returns all checks (or a reasonable recent subset)
      // belonging to this userId. For now, it's fine to return all checks for that tenant.
      const checks = await storage.getAllRightToWorkChecksForUser(userId);

      // Build a CSV with columns such as:
      // employeeName, employeeId, checkId, workStatus, documentType, documentNumber,
      // expiryDate, createdAt
      // Where employeeName/employeeId can be derived by joining with employees if available;
      // otherwise, leave empty.

      const header = [
        "employeeName",
        "employeeId",
        "checkId",
        "workStatus",
        "documentType",
        "documentNumber",
        "expiryDate",
        "createdAt"
      ];

      const rows = [header.join(",")];

      for (const check of checks) {
        // Attempt to fetch employee for this check; if not available, use empty strings.
        let employeeName = "";
        let employeeExternalId = "";
        if (check.employeeId) {
          const employee = await storage.getEmployeeByIdAndUserId(check.employeeId, userId);
          if (employee) {
            employeeName = employee.name ?? "";
            employeeExternalId = employee.externalId ?? "";
          }
        }

        const row = [
          JSON.stringify(employeeName),
          JSON.stringify(employeeExternalId),
          JSON.stringify(check.id),
          JSON.stringify(check.workStatus),
          JSON.stringify(check.documentType ?? ""),
          JSON.stringify(check.documentNumber ?? ""),
          JSON.stringify(check.expiryDate ?? ""),
          JSON.stringify(check.createdAt ?? "")
        ].join(",");

        rows.push(row);
      }

      const csv = rows.join("\n");

      res.setHeader("Content-Type", "text/csv; charset=utf-8");
      res.setHeader("Content-Disposition", "attachment; filename=\"certia-checks.csv\"");
      return res.send(csv);
    } catch (err) {
      console.error("Error exporting checks CSV:", err);
      return res.status(500).json({ error: "Failed to export checks CSV" });
    }
  });
Implement storage.getAllRightToWorkChecksForUser(userId) using existing patterns for listing checks by tenant. Keep it simple and tenant-safe:

Only return checks where check.userId === userId.

Order by createdAt descending or as appropriate.

3.2) Frontend: CSV export button on dashboard

On the main dashboard page (client/src/pages/dashboard.tsx):

Add a small, secondary action button near the top (e.g., near the main title):

Label: “Export checks (CSV)”

On click:

Trigger a GET request to /api/audit/checks.csv.

Handle this as a file download (e.g., by setting window.location.href or creating a hidden <a> with href set to that endpoint).

UX:

Show a brief helper text near the button, e.g.:

“Download a CSV of right-to-work checks for audit or offline analysis.”

No need for progress indicators; the browser will handle download feedback.

==================================================
TASK 4 — Safety & regression checks
Ensure:

All new routes are behind isAuthenticated.

No tenant leakage: CSV export and any employee-level data only include checks belonging to the current userId.

Notes content is included in print but not logged or exported via CSV.

Verify manually:

Check detail:

“Print summary” → prints a clean, structured audit report for a single check, including notes and missing information.

Employee detail:

“Print employee audit report” → prints a consolidated report of that employee’s checks.

Dashboard:

“Export checks (CSV)” → downloads a CSV that opens correctly in Excel/Sheets with sensible column values.

Existing flows (New Check, Renewals card, Notes, AI diagnostics) still behave as before.

Do not introduce any new, unrelated refactors or UI rebuilds. Focus only on:

Upgrading print views,

Adding the employee-level audit print,

Adding CSV export.